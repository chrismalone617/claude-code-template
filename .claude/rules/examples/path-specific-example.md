# Path-Specific Rules Example

<!--
This example shows how to create rules that only apply to specific files or directories.
The YAML frontmatter defines which paths these rules apply to and their priority.
-->

---
name: test-rules
paths:
  - "**/*.test.ts"
  - "**/*.spec.ts"
  - "**/__tests__/**"
priority: 20
---

# Test File Rules

These rules apply only to test files.

## Test Naming

Test files should match the source file name with `.test.ts` or `.spec.ts` suffix.

```
src/
  components/
    Button.tsx
    Button.test.tsx        # ✓ Test file next to source
  services/
    userService.ts
    userService.test.ts    # ✓ Test file next to source
```

## Test Structure

Use `describe` blocks to organize tests by feature/method.

```typescript
describe('UserService', () => {
  describe('createUser', () => {
    it('creates a user with valid data', () => {
      // Test implementation
    });

    it('throws error for invalid email', () => {
      // Test implementation
    });
  });

  describe('getUserById', () => {
    it('returns user when found', () => {
      // Test implementation
    });

    it('returns null when not found', () => {
      // Test implementation
    });
  });
});
```

## Test Independence

Each test should be completely independent. Use `beforeEach` for setup.

```typescript
describe('TodoList', () => {
  let todoList: TodoList;

  beforeEach(() => {
    // Fresh instance for each test
    todoList = new TodoList();
  });

  it('starts empty', () => {
    expect(todoList.items).toHaveLength(0);
  });

  it('can add an item', () => {
    todoList.add('Buy milk');
    expect(todoList.items).toHaveLength(1);
  });
});
```

---
name: migration-rules
paths:
  - "prisma/migrations/**"
  - "db/migrations/**"
  - "**/migrations/**"
priority: 25
---

# Database Migration Rules

These rules apply only to database migration files.

## Migration Naming

Use descriptive names with timestamps (usually auto-generated by ORM).

```
migrations/
  20240115_120000_create_users_table.sql
  20240115_130000_add_email_index.sql
  20240116_090000_add_posts_table.sql
```

## Migration Structure

Each migration should be:
- **Reversible**: Include both up and down migrations when possible
- **Idempotent**: Safe to run multiple times
- **Atomic**: One logical change per migration

```sql
-- Up Migration
CREATE TABLE IF NOT EXISTS users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);

-- Down Migration (in separate file or section)
DROP INDEX IF EXISTS idx_users_email;
DROP TABLE IF EXISTS users;
```

## Migration Safety

- Never edit existing migrations that have been deployed
- Always use IF EXISTS/IF NOT EXISTS for safety
- Test migrations on production-like data
- Back up before running migrations

---
name: config-rules
paths:
  - "**/*.config.ts"
  - "**/*.config.js"
  - "**/config/**"
priority: 15
---

# Configuration File Rules

These rules apply to configuration files.

## Configuration Structure

Keep configuration well-typed and documented.

```typescript
// config/app.config.ts
interface AppConfig {
  /** Application port */
  port: number;
  /** Node environment */
  env: 'development' | 'production' | 'test';
  /** Database connection string */
  databaseUrl: string;
  /** JWT secret for token signing */
  jwtSecret: string;
  /** Redis connection URL */
  redisUrl?: string;
}

export const config: AppConfig = {
  port: parseInt(process.env.PORT || '3000', 10),
  env: (process.env.NODE_ENV as any) || 'development',
  databaseUrl: process.env.DATABASE_URL!,
  jwtSecret: process.env.JWT_SECRET!,
  redisUrl: process.env.REDIS_URL
};

// Validate required config on startup
if (!config.databaseUrl) {
  throw new Error('DATABASE_URL environment variable is required');
}
if (!config.jwtSecret) {
  throw new Error('JWT_SECRET environment variable is required');
}
```

## Environment Variables

- Never commit secrets to config files
- Use environment variables for all secrets
- Provide `.env.example` with dummy values
- Document all required env vars

```typescript
// ✓ GOOD: Use environment variables
const apiKey = process.env.API_KEY;

// ✗ BAD: Hardcoded secrets
const apiKey = 'sk_live_abc123...';
```

---
name: docker-rules
paths:
  - "**/Dockerfile"
  - "**/docker-compose*.yml"
  - "**/.dockerignore"
priority: 15
---

# Docker Configuration Rules

## Dockerfile Best Practices

```dockerfile
# Use specific version tags, not 'latest'
FROM node:18-alpine

# Set working directory
WORKDIR /app

# Copy package files first (better layer caching)
COPY package*.json ./

# Install dependencies
RUN npm ci --only=production

# Copy application code
COPY . .

# Use non-root user
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001
USER nodejs

# Expose port
EXPOSE 3000

# Use exec form for CMD
CMD ["node", "dist/index.js"]
```

## Docker Compose

```yaml
version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://user:pass@db:5432/mydb
    depends_on:
      - db
      - redis

  db:
    image: postgres:15-alpine
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      - POSTGRES_PASSWORD=${DB_PASSWORD}

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

---
name: documentation-rules
paths:
  - "**/*.md"
  - "**/docs/**"
priority: 10
---

# Documentation File Rules

## Markdown Structure

Use proper heading hierarchy and formatting.

```markdown
# Main Title (H1) - Only one per document

## Section (H2)

### Subsection (H3)

#### Detail (H4)

## Another Section

- Use lists for multiple items
- Keep items consistent
- End with period if full sentences

\`\`\`typescript
// Code blocks should specify language
const example = 'for syntax highlighting';
\`\`\`

> Use blockquotes for important notes

| Column 1 | Column 2 |
|----------|----------|
| Data     | Data     |
```

## Documentation Maintenance

- Update docs in the same PR as code changes
- Include code examples that work
- Link between related documentation
- Keep examples up-to-date
- Remove outdated documentation
